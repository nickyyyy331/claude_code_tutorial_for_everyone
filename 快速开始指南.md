# 🚀 快速开始指南

## 针对你的问题的完整解决方案

### 问题总结

你遇到的错误：
```
InvalidArgumentError: Invalid URL protocol: the URL must start with `http:` or `https:`
```

**根本原因：** WSL NAT 模式下，从 Windows 继承的 `localhost` 代理配置无法正常工作。

---

## 🎯 立即修复（3 步）

### 步骤 1：下载仓库文件（如果还没有）

```bash
# 克隆或拉取最新代码
cd /mnt/c/Users/sdu_l
git clone https://github.com/nickyyyy331/claude_code_tutorial_for_everyone.git
cd claude_code_tutorial_for_everyone

# 或者如果已有仓库
cd claude_code_tutorial_for_everyone
git pull
```

### 步骤 2：运行自动修复脚本

```bash
# 添加执行权限
chmod +x fix-wsl-claude-proxy.sh

# 运行脚本（会提示输入 API Key）
./fix-wsl-claude-proxy.sh
```

**重要：** 脚本会检测到你的 API Key 未设置，此时你需要：

```bash
# 先设置 API Key
export ANTHROPIC_API_KEY="your-actual-api-key-here"

# 然后重新运行脚本
./fix-wsl-claude-proxy.sh
```

### 步骤 3：启动 Claude Code

```bash
# 加载环境配置
source ~/.claude-code-env

# 启动 Claude Code
npx --yes @anthropic-ai/claude-code
```

---

## 💡 或者手动快速修复（如果脚本不工作）

```bash
# 1. 清除所有代理
unset http_proxy https_proxy HTTP_PROXY HTTPS_PROXY all_proxy ALL_PROXY

# 2. 设置绕过代理
export NO_PROXY="api.anthropic.com,localhost,127.0.0.1"
export no_proxy="api.anthropic.com,localhost,127.0.0.1"

# 3. 设置 API Key
export ANTHROPIC_API_KEY="your-actual-api-key-here"

# 4. 验证设置
echo "代理设置: $(env | grep -i proxy || echo '✓ 无代理')"
echo "API Key: ${ANTHROPIC_API_KEY:0:20}..."

# 5. 启动 Claude Code
npx --yes @anthropic-ai/claude-code
```

---

## ⚙️ 永久配置（推荐）

为了避免每次都要重新设置，将配置添加到 shell 启动文件：

```bash
# 创建配置文件
cat > ~/.claude-code-env << 'EOF'
# 清除代理
unset http_proxy https_proxy HTTP_PROXY HTTPS_PROXY all_proxy ALL_PROXY

# 设置绕过代理
export NO_PROXY="api.anthropic.com,localhost,127.0.0.1"
export no_proxy="api.anthropic.com,localhost,127.0.0.1"

# 设置 API Key
export ANTHROPIC_API_KEY="your-actual-api-key-here"
EOF

# 添加到 .bashrc（每次启动自动加载）
echo '' >> ~/.bashrc
echo '# Claude Code 配置' >> ~/.bashrc
echo 'if [ -f ~/.claude-code-env ]; then' >> ~/.bashrc
echo '    source ~/.claude-code-env' >> ~/.bashrc
echo 'fi' >> ~/.bashrc

# 立即加载
source ~/.bashrc
```

---

## 🧪 测试连接

在启动 Claude Code 之前，先测试 API 连接：

```bash
# 测试 1: 检查网络连接
curl -I https://api.anthropic.com

# 测试 2: 测试 API Key（应返回 400 或 200，表示能连接）
curl -s -o /dev/null -w "%{http_code}\n" \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  https://api.anthropic.com/v1/messages
```

**预期结果：**
- 测试 1: 应该看到 `HTTP/2 200` 或类似输出
- 测试 2: 应该看到 `400` 或 `200`（表示能连接，只是请求格式不完整）

---

## 📱 启动 Claude Code 的多种方式

### 方式 1：使用 npx（推荐，无需全局安装）

```bash
npx --yes @anthropic-ai/claude-code
```

### 方式 2：使用全局安装的命令

```bash
# 如果之前已经全局安装
claude
```

### 方式 3：使用完整路径

```bash
/usr/local/lib/node_modules/@anthropic-ai/claude-code/cli.js
```

### 方式 4：创建别名（方便）

```bash
# 添加到 ~/.bashrc
echo 'alias claude="npx --yes @anthropic-ai/claude-code"' >> ~/.bashrc
source ~/.bashrc

# 之后直接使用
claude
```

---

## 🔍 故障排除

### 问题 1: 仍然报 "Invalid URL protocol" 错误

**解决方案：**

```bash
# 完全重置环境
# 1. 关闭所有 WSL 窗口
# 2. 在 Windows PowerShell 中运行
wsl --shutdown

# 3. 重新打开 WSL
wsl

# 4. 重新加载配置
source ~/.claude-code-env

# 5. 验证代理已清除
env | grep -i proxy
# 应该只显示 NO_PROXY 和 no_proxy

# 6. 启动 Claude Code
npx --yes @anthropic-ai/claude-code
```

### 问题 2: API Key 无效

**检查步骤：**

```bash
# 1. 检查 API Key 格式
echo -n "$ANTHROPIC_API_KEY" | wc -c
# 应该显示约 108 字符

# 2. 检查 API Key 前缀
echo "${ANTHROPIC_API_KEY:0:14}"
# 应该显示: sk-ant-api03-

# 3. 确保没有多余空格
echo "[$ANTHROPIC_API_KEY]"
# 检查是否有空格
```

### 问题 3: 网络连接问题

**检查网络：**

```bash
# 1. 检查 DNS
nslookup api.anthropic.com

# 2. 检查能否访问外网
ping -c 3 8.8.8.8

# 3. 检查 HTTPS 连接
curl -v https://www.anthropic.com
```

如果网络有问题，可能需要：
- 检查 Windows 防火墙设置
- 检查 WSL 网络配置
- 检查是否需要使用 VPN

### 问题 4: 权限错误

```bash
# 修复 npm 权限
sudo chown -R $(whoami) $(npm root -g)

# 或者使用 npx（不需要全局安装）
npx --yes @anthropic-ai/claude-code
```

---

## 📚 更多信息

- **完整故障排除指南：** [WSL-Claude-Code-故障排除指南.md](./WSL-Claude-Code-故障排除指南.md)
- **仓库 README：** [README.md](./README.md)
- **官方文档：** https://docs.anthropic.com

---

## ✅ 成功标志

当一切正常时，你应该看到：

```
┌────────────────────────────────────────────┐
│                                            │
│   Welcome to Claude Code!                  │
│                                            │
│   Model: claude-sonnet-4-5-20250929       │
│                                            │
└────────────────────────────────────────────┘

How can I help you today?
>
```

---

## 🎉 恭喜！

现在你可以开始使用 Claude Code 了！

**常用命令：**
- 直接输入问题或任务
- `/help` - 查看帮助
- `/exit` - 退出
- Ctrl+C - 中断当前操作

**示例任务：**
```
> 帮我写一个 Python 脚本，计算斐波那契数列

> 创建一个简单的 HTML 页面，包含导航栏和主内容区域

> 解释这段代码的作用：[粘贴代码]
```

祝使用愉快！🚀
